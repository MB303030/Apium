name: iOS WDIO Tests (On Demand)

# Trigger workflow manually from the Actions tab
on:
  workflow_dispatch:

jobs:
  ios-test:
    runs-on: macos-latest

    steps:
      # 1ï¸âƒ£ Checkout the repo
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Setup Node 25
      - name: ğŸŸ¢ Setup Node.js v25
        uses: actions/setup-node@v4
        with:
          node-version: '25.x'

      # 3ï¸âƒ£ Install dependencies
      - name: ğŸ“¦ Install NPM packages
        run: npm ci

      # 4ï¸âƒ£ List available iOS simulators
      - name: ğŸ“± List iOS Simulators
        run: xcrun simctl list devices

      # 5ï¸âƒ£ Start Appium server in background
      - name: ğŸš€ Start Appium 3 server
        run: |
          npx appium --port 4723 --base-path /wd/hub > appium.log 2>&1 &
          sleep 15
          curl http://localhost:4723/wd/hub/status

      # 6ï¸âƒ£ Run WDIO tests
      - name: ğŸ§ª Run WebdriverIO Tests
        run: npx wdio run wdio.conf.js

      # 7ï¸âƒ£ Upload Mochawesome reports
      - name: ğŸ“¤ Upload Mochawesome Reports
        uses: actions/upload-artifact@v4
        with:
          name: reports
          path: reports/
